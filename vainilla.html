<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Chatbot</title>
</head>
<body>
</body>

<script>
    function createHtml() {
        const chatbotContainer = document.createElement('div');
        chatbotContainer.className = 'chatbot-container';
        chatbotContainer.innerHTML = `
            <div class="chatbot-header">
                <div class="header-left">
                    <span id="widgetName"></span>
                    <span class="online-status"></span>
                </div>
                <div class="header-right">
                    <button id="closeButton">&times;</button>
                </div>
            </div>
            <div class="chatbot-body" id="chatBody">
                <div class="chat-intro" id="chatIntro">
                    <div class="image-container">
                        <img src="https://i.imgur.com/Iqf1qVH.jpg" alt="Kitti Kovács" class="intro-image"/>
                        <span class="online-dot"></span>
                    </div>
                    <h2 class="intro-name">Kitti Kovács</h2>
                    <p class="intro-description">I am Kitti Kovács, your chameleoni assistant!</p>
                </div>
                <!-- Chat messages will appear here -->
            </div>
            <div class="chatbot-footer">
                <input type="text" id="chatInput" placeholder="Write a reply..." />
                <button id="sendButton" disabled>&#9658;</button>
            </div>
        `;
        document.body.appendChild(chatbotContainer);

        const chatIcon = document.createElement('button');
        chatIcon.className = 'chat-icon-button';
        chatIcon.innerHTML = `&#x1F4AC;`;  
        document.body.appendChild(chatIcon);
    }

    function createCss() {
        const style = document.createElement('style');
        style.textContent = `
            body {
                font-family: Arial, sans-serif;
                margin: 0;
                padding: 0;
                background-color: #f4f4f4;
            }

            .chatbot-container {
                width: 300px;
                max-width: 100%;
                position: fixed;
                bottom: 100px;
                right: 90px;
                border-radius: 10px;
                overflow: hidden;
                box-shadow: 0 0 15px rgba(0, 0, 0, 0.2);
                background-color: white;
                display: none;
                z-index: 1000;
            }

            .chatbot-header {
                background-color: #0056b3; /* Blue header */
                color: white;
                padding: 10px;
                display: flex;
                align-items: center;
                justify-content: space-between;
            }

            .header-left {
                display: flex;
                align-items: center;
            }

            .header-right {
                display: flex;
                align-items: center;
            }

            .online-status {
                display: inline-block;
                width: 10px;
                height: 10px;
                background-color: #28a745;
                border-radius: 50%;
                margin-left: 5px;
            }

            .chatbot-body {
                padding: 10px;
                height: 300px;
                overflow-y: auto;
                position: relative;
            }

            .chat-intro {
                position: sticky;
                top: 0;
                background-color: white;
                padding: 10px 0;
                text-align: center;
                z-index: 10;
                transition: opacity 0.3s ease-in-out;
            }

            .image-container {
                position: relative;
                display: inline-block;
                margin-bottom: 5px;
            }

            .intro-image {
                width: 50px;
                height: 50px;
                border-radius: 50%;
            }

            .online-dot {
                position: absolute;
                bottom: 5px;
                right: 5px;
                width: 10px;
                height: 10px;
                background-color: #28a745;
                border-radius: 50%;
                border: 2px solid white; /* adds a white border around the green dot */
            }

            .intro-name {
                margin: 5px 0 0 0;
                font-size: 16px; /* Smaller font size */
            }

            .intro-description {
                font-size: 14px; /* Smaller font size */
                margin: 5px 0 0 0;
            }

            .chatbot-footer {
                padding: 10px;
                border-top: 1px solid #ddd;
                display: flex;
                align-items: center;
            }

            .chatbot-footer input[type="text"] {
                flex: 1;
                padding: 10px;
                border-radius: 20px;
                border: 1px solid #ddd;
                outline: none;
            }

            .chatbot-footer button {
                background-color: #0056b3; /* Send button color */
                border: none;
                color: white;
                padding: 10px;
                border-radius: 50%;
                margin-left: 10px;
                cursor: pointer;
            }

            .chatbot-footer button:disabled {
                background-color: #ddd;
                cursor: not-allowed;
            }

            .message-sent,
            .message-received {
                margin-bottom: 10px;
                clear: both;
            }

            .message-sent {
                text-align: right;
            }

            .message-received {
                text-align: left;
            }

            .message-sent .message,
            .message-received .message {
                display: inline-block;
                padding: 10px 15px;
                border-radius: 20px;
                max-width: 70%;
            }

            .message-sent .message {
                background-color: #0056b3; /* Sent message bubble */
                color: white;
            }

            .message-received .message {
                background-color: #eee; /* Received message bubble */
                color: #333;
            }

            .chat-icon-button {
                position: fixed;
                bottom: 20px;
                right: 20px;
                background-color: #0056b3;
                color: white;
                border: none;
                width: 60px;
                height: 60px;
                border-radius: 50%;
                display: flex;
                align-items: center;
                justify-content: center;
                font-size: 30px;
                cursor: pointer;
                box-shadow: 0 0 10px rgba(0, 0, 0, 0.2);
                z-index: 1001;
            }
        `;
        document.head.appendChild(style);
    }

    function addFunctionality() {
        var botParameters = {
            "botname": "ChameleonI Bot",
            "welcome": "I am Kitti Kovács, your chameleoni assistant!",
            "widgetName": "Kitti Kovács",
            "autoPop": 15,
        };

        function initializeChat() {
            document.getElementById('widgetName').textContent = botParameters.widgetName;
            populateChatHistory();

            if (botParameters.autoPop === 0) {
            } else if (botParameters.autoPop === 1) {
                setTimeout(function() {
                    document.querySelector('.chatbot-container').style.display = 'block';
                }, 1000);
            } else if (botParameters.autoPop > 1) {
                setTimeout(function() {
                    document.querySelector('.chatbot-container').style.display = 'block';
                }, botParameters.autoPop * 1000);
            }
        }

        function populateChatHistory() {
            var chatBody = document.getElementById('chatBody');
            var history = JSON.parse(localStorage.getItem('chatHistory')) || [];

            history.forEach(function(chat) {
                var messageDiv = document.createElement('div');
                messageDiv.className = chat.type === 'sent' ? 'message-sent' : 'message-received';

                var messageContent = document.createElement('div');
                messageContent.className = 'message';
                messageContent.textContent = chat.message;

                messageDiv.appendChild(messageContent);
                chatBody.appendChild(messageDiv);
            });
            chatBody.scrollTop = chatBody.scrollHeight;
        }

        function saveChatHistory(message, type) {
            var history = JSON.parse(localStorage.getItem('chatHistory')) || [];
            history.push({ message: message, type: type });
            localStorage.setItem('chatHistory', JSON.stringify(history));
        }

        function sendMessage() {
            var inputField = document.getElementById('chatInput');
            var userMessage = inputField.value;
            if (userMessage.trim() === '') return;

            // Display user's message
            var newMessageDiv = document.createElement('div');
            newMessageDiv.className = 'message-sent';
            var newMessageContent = document.createElement('div');
            newMessageContent.className = 'message';
            newMessageContent.textContent = userMessage;
            newMessageDiv.appendChild(newMessageContent);
            document.getElementById('chatBody').appendChild(newMessageDiv);

            saveChatHistory(userMessage, 'sent');

            inputField.value = '';
            document.getElementById('sendButton').disabled = true;

            // Echo the user's message back as the bot's response
            setTimeout(() => {
                var botMessageDiv = document.createElement('div');
                botMessageDiv.className = 'message-received';
                var botMessageContent = document.createElement('div');
                botMessageContent.className = 'message';
                botMessageContent.textContent = userMessage;  // Echo the message back
                botMessageDiv.appendChild(botMessageContent);
                document.getElementById('chatBody').appendChild(botMessageDiv);

                saveChatHistory(userMessage, 'received');

                // Scroll to the bottom of the chat
                document.getElementById('chatBody').scrollTop = document.getElementById('chatBody').scrollHeight;
            }, 500);  // Delay to mimic response time
        }

        document.getElementById('sendButton').addEventListener('click', sendMessage);

        document.getElementById('chatInput').addEventListener('input', function() {
            document.getElementById('sendButton').disabled = this.value.trim() === '';
        });

        document.getElementById('chatInput').addEventListener('keydown', function(event) {
            if (event.key === 'Enter') {
                event.preventDefault(); 
                if (!document.getElementById('sendButton').disabled) {
                    sendMessage();
                }
            }
        });

        document.getElementById('closeButton').addEventListener('click', function() {
            document.querySelector('.chatbot-container').style.display = 'none';
        });

        document.querySelector('.chat-icon-button').addEventListener('click', function() {
            document.querySelector('.chatbot-container').style.display = 'block';
        });

        document.getElementById('chatBody').addEventListener('scroll', function() {
            const chatIntro = document.getElementById('chatIntro');
            if (this.scrollTop > 20) {
                chatIntro.style.opacity = '0';
            } else {
                chatIntro.style.opacity = '1';
            }
        });

        initializeChat();
    }

    createHtml();
    createCss();
    addFunctionality();
</script>
</html>
